---
tags:
  - type/writing/social-media
status: published
created-date: 10-12-2024
---
## Post #10 - Rootkit vs Anti-Malware a never ending Saga

⚔ Rootkit vs Anti-Malware a never ending Saga🤺

Malwares have evolved in terms of its technical capabilities along with its ability remain undetected and carry out covert operations and this Arm Race is about developing new ways to hide in the system.

On the flip side of this Arm Race we have Security Architects, Anti-Virus Vendors, System Designers which have been spinning out new security features and mitigation but this Arm Races doesn't seems to end.

A very important arsenal this Arm Race is Evading Detection and Surviving System Reboot(Persistence). Malwares installing malicious Kernel Driver to evade User-land detection and this was thwarted by "Driver Signature Enforcement (DSE)". 🛡

You see Kernel is very privileged part of the OS which does very critical data Structures and Code on which the User-land API depends on. Corrupting it means to compromise the System Core and compromising the integrity of the whole system since User-space API are merely window to Kernel Functionality and Data.

To Prevent this kind of attack Microsoft came-up DSE, the idea was to ensure Code Integrity of Driver package and Trustworthiness of Publisher(the source). For this to work, Vendor had go through formal verification process with Microsoft Hardware Quality Lab (WHQL) to verify their Driver Code, once the verification was completed WHQL would issued a Digital certificate to the Vendor. 🏢

Vendors would use this certificate to sign the Driver binary and signature was embedded in the driver binary.

Operating System Kernel while loading the Driver binary in the Kernel it will first verify the signature and load only if the Kernel signature is valid. Signature can be obtained by signing-up with Microsoft Portal and go through a verification process.

There were still several ways around this problem

[1]. This didn't mean that you couldn't Kernel was fully protected, you could still exploit vulnerability in kernel or third party driver and load malicious Driver post exploitation in the Kernel. 🐞

In fact, Malware used this trick in a very clever manner to bypass Signature Verification. It would forcefully load old Signed Vulnerable Driver in the Kernel and then exploited the Vulnerability in the driver then later loaded the actual Malicious Driver from the Kernel. 👾

[2]. Another type of attack was "Stealing Certificates" from the Vendors or buying it from Underground Forums. Attacker was then use these certificates to sign their Malicious Code.

[3] Another attack is to "Game the Process", the trick here is to create a driver that look normal to the security checks implemented by Microsoft during the review process. 🎰

Attack 2 & 3 were mitigated by Revoking the Certificate/Vendor which would render the Driver Unsigned and untrusted.🛡

Malware authors come up entirely new Attack Vector which is infecting the early stage of the System Boot Process 👢, but that a discussion for another post.