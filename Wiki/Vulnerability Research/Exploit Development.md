![](exploit_devel_mind_map.png)

# Exploit Development Workflow

1.  Root Cause Analysis
2.  Basic Exploitation Strategy
3.  Searching Code Base
4.  Gaining Remote Code Execution
5.  Safe Returns

## Root Cause Analysis

Root Cause Analysis (RCA) is an important first step towards exploit creation and it cannot be skipped.

Creating an exploit involves triggering application crash in a controlled manner, so it is necessary to understand exactly how the crash is triggered.

**Gaining this knowledge is termed as RCA.**

RCA allows the **type of vulnerability** to be **identified** (like use-after-free, out-of-bounds-memory-access, memory-corruption and so on). Once the type of vulnerability is identified a basic strategy can be created to control the crash in a way to gain more control, possibly leading to remote code execution.

Doing RCA involves understanding the code that lead to the crash but in a reverse manner, starting from the point of crash.

Generally, after RCA we are able to answer the following type of questions:

-   Does the latest stable version of application crash?
-   What is the latest version of application that can reproduce the crash?
-   What part of the application code base is primarily involved in the crash?
-   How easily can the crash be triggered from user input?
-   What type of vulnerability is it?
-   Is it likely to gain remote code execution from the crash?
-   What is the minimal user input that can crash the application?

RCA can be the **most time consuming** task in the exploit development workflow. To reduce this time debugger scripts and techniques like time travel debugging (Windows 10) can be used.

Using snapshot capability of virtual machines might prove useful, but not always.

The ease of RCA depends on how easy it is to understand the code responsible for crash. This can be **augmented by application source code**, depending on how straight forward it is.

### Resources

-   [How Vulnerabilities are Exploited: the Root Causes of Exploited Remote Code Execution Cves](https://www.microsoft.com/security/blog/2014/06/24/how-vulnerabilities-are-exploited-the-root-causes-of-exploited-remote-code-execution-cves/)
-   [Vulnerability Root Cause Analysis With Time Travel Debugging](https://darungrim.com/research/2019-10-10-vulnerability-root-cause-analysis-with-time-travel-debugging.html)
-   [Root Cause Analysis of CVE-2014-1772 – An Internet Explorer Use After Free Vulnerability](https://blog.trendmicro.com/trendlabs-security-intelligence/root-cause-analysis-of-cve-2014-1772-an-internet-explorer-use-after-free-vulnerability/)
-   [Root Cause Analysis – Integer Overflows](https://www.corelan.be/index.php/2013/07/02/root-cause-analysis-integer-overflows/)
-   [Root Cause Analysis – Memory Corruption Vulnerabilities](https://www.corelan.be/index.php/2013/02/26/root-cause-analysis-memory-corruption-vulnerabilities/)

## Basic Exploitation Strategy

Here depending on the vulnerability type, a bare bones framework is decided upon.

It may involve creating specific memory layouts, giving certain inputs at specific stage of execution etc.

The following questions need to be answered at this stage according to the vulnerability type:

-   What are the exploit mitigations that may interfere with final exploit?
-   Are there any workarounds for bypassing these mitigations?
-   Inside which memory (stack/heap) the crash occurs?
-   What part of user supplied data and its size can cause crash?
-   If the crash is in heap memory, which heap is it?

This set of steps may need to be modified as problems are encountered during development of exploit.

Depending on the answers to these questions, some basic steps can be decided:

-   Size of data
-   Format of data
-   Create certain memory layout
-   Leak data from specific memory location
-   Overwrite data to specific memory location

The precise details of each step may be left vague at this stage.

Consider the use-after-free vulnerability type. For this type, the usual basic strategy is as follows:

-   Create a specific memory layout on the heap
-   Trigger the free
-   Re-assign the free-ed memory with user controlled data, thus creating a fake data totally controlled by user input
-   Using this fake data, gain arbitrary read and write capability
-   Overwrite address within a method table to point to shellcode
-   Call the overwritten method to trigger shellcode execution leading to remote code execution

In the above case of use-after-free, exploit mitigations are not considered like **Control Flow Guard** and memory protections. So those steps will need to be modified as and when such mitigations are encountered.

### Resources

-   [Simple, Mitigation-less Stack Buffer Overflow Exploitation](https://www.corelan.be/index.php/2009/07/19/exploit-writing-tutorial-part-1-stack-based-overflows/)
-   [Different ways for Stack Buffer Overflow Exploitation](https://www.corelan.be/index.php/2009/07/23/writing-buffer-overflow-exploits-a-quick-and-basic-tutorial-part-2/)
-   [SEH Based Exploitation & Bypassing Different SEH Related Mitigations](https://www.corelan.be/index.php/2009/07/25/writing-buffer-overflow-exploits-a-quick-and-basic-tutorial-part-3-seh/)
-   [Bypassing Some More Mitigations](https://www.corelan.be/index.php/2009/09/21/exploit-writing-tutorial-part-6-bypassing-stack-cookies-safeseh-hw-dep-and-aslr/)
-   [DEP & ROP](https://www.corelan.be/index.php/2010/06/16/exploit-writing-tutorial-part-10-chaining-dep-with-rop-the-rubikstm-cube/)
-   [Heap Spraying Demystified](https://www.corelan.be/index.php/2011/12/31/exploit-writing-tutorial-part-11-heap-spraying-demystified/)
-   [List of All Corelan Exploit Writing Tutorials](https://www.corelan.be/index.php/category/security/exploit-writing-tutorials/)

## Source Code Review

From here onwards, the basic framework created in the previous stage is filled out with details.

Depending on the basic steps, the code base will be searched for certain things like format of data to be used, objects to be used for creating memory layouts and so on.

For use-after-free vulnerability, one of the steps is to create a specific memory layout so that the use and free occurs in a controlled manner.

For creating such a memory layout it is important to understand:

-   Types of heaps used by the target application
-   Type of heap where the use-after-free occurs
-   Other data/objects that can be placed in the use-after-free heap
-   Which of these data/objects can be utilized with maximum ease to read or write arbitrary memory locations

For gaining insight into above points the code base of target application is searched.

The object to be **faked** may be an **array** with the beginning and end of array being in control of user. Such an array when faked using the **use-after-free** will grant the capability to read/write arbitrary memory locations if the **beginning and end are set to beginning and end of address space**, respectively, of process.

In this case, it will be **possible to scan the entire address space** of the process in the absence of other factors like memory protections and memory state.

## Gaining Remote Code Execution

The final target of any exploit is to gain remote code execution on target.

The way to achieve this is defined by:

-   Exploit mitigations present
-   Type of vulnerability

In case of **buffer overflow** vulnerability, if **exploit mitigations are absent**, it becomes a **straight forward** task of corrupting the stack for pivoting to shellcode to **gain remote code execution**.

On the other hand, there are certain **mitigations** used specifically against **buffer overflow** like:

-   Stack Canary
    
    Used to detect stack corruption by inserting a known value on stack at known location, thus preventing shellcode handover
    
-   Data Execution Prevention (DEP)
    
    Prevents data (stack/heap) from executing as code by setting relevant memory protection values
    
-   Address Space Layout Randomization (ASLR)
    
    Makes it difficult to use a pivot to jump to shellcode by randomizing addresses of modules
    

To bypass such mitigations one or more of the following techniques may be used:

-   Forcing application to use static canary
    
    This static value of stack canary is used in buffer overflow payload and thus the mitigation is bypassed
    
-   Leaking the stack canary/Predicting the stack canary
    
    Runtime random canary computation makes it difficult to know its value beforehand during exploit creation. So canary value can either be leaked by some other technique or fairly accurate predictions of canary can be done for low entropy random generators
    
-   Loading of non-ASLR code
    
    Target application might depend on old/obsolete/non updated modules which will not have ASLR enabled. Ways can be found to force target application to load these modules so known addresses from these can be used
    
-   Entropy of ASLR addresses
    
    In case there is no non-ASLR code to be found, an educated guess can be made as to the required address for low entropy inducing algorithms
    
-   Return oriented Programming
    
    Mainly used to make memory executable where code is loaded as data (bypass DEP). This technique causes a set of known arbitrary code addresses to be executed leading to change in memory protections
    

## Safe Returns

Once remote code execution has been achieved, it is **necessary** that the **application continues to work as expected**.

This is important as it is **possible** that after code execution, **application** might simply **crash or behave in an abnormal manner**.

To avoid this, a handover is done to that part to application code which will not cause a crash. Such a code is found while searching the code base.

Sometimes, such safe code may not be available. The **actual application instance** can be **terminated** and a **decoy instance** can be executed with **benign data**. It may be also possible to do a **cleanup of memory** and resume normal application behavior without termination.

While developing the exploit, light may be shed on some facts, like the location of stack frame for example, which will make it easy to resume normal execution.


# Linux stack/heap exploitation

​

## Reading Material

Hacking: The art of exploitation  
The shellcoder's handbook  
​

## Reading and Practicing

​  
[https://github.com/RPISEC/MBE](https://github.com/RPISEC/MBE)  
[http://guyinatuxedo.github.io](http://guyinatuxedo.github.io)  
​

## Practice

​  
[https://pwnable.xyz](https://pwnable.xyz)  
[https://pwnable.kr](https://pwnable.kr)  
[https://pwnable.tw](https://pwnable.tw)  
​

## References

​  
[https://guyinatuxedo.github.io/references/index.html](https://guyinatuxedo.github.io/references/index.html)  
​

# Linux kernel exploitation

​

## Reading Material

​  
[https://github.com/R3x/How2Kernel/tree/master/Lab1](https://github.com/R3x/How2Kernel/tree/master/Lab1)  
[http://jake.dothome.co.kr/slub/](http://jake.dothome.co.kr/slub/)  
[https://jon.oberheide.org/blog/2010/11/02/csaw-ctf-kernel-exploitation-challenge/](https://jon.oberheide.org/blog/2010/11/02/csaw-ctf-kernel-exploitation-challenge/)  
[https://jon.oberheide.org/blog/2011/11/27/csaw-ctf-2011-kernel-exploitation-challenge/](https://jon.oberheide.org/blog/2011/11/27/csaw-ctf-2011-kernel-exploitation-challenge/)  
[https://whereisk0shl.top/NCSTISC Linux Kernel pwn450 writeup.html](https://whereisk0shl.top/NCSTISC%20Linux%20Kernel%20pwn450%20writeup.html)  
[https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/linux-kernel-rop-ropping-your-way-to-part-1/](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/linux-kernel-rop-ropping-your-way-to-part-1/)  
[https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/linux-kernel-rop-ropping-your-way-to-part-2/](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/linux-kernel-rop-ropping-your-way-to-part-2/)  
[https://www.lazenca.net/display/TEC/03.Linux+Kernel+Exploitation+Tutorial](https://www.lazenca.net/display/TEC/03.Linux+Kernel+Exploitation+Tutorial)  
[https://blog.lexfo.fr/cve-2017-11176-linux-kernel-exploitation-part1.html](https://blog.lexfo.fr/cve-2017-11176-linux-kernel-exploitation-part1.html)  

## Practice

[https://github.com/R3x/How2Kernel](https://github.com/R3x/How2Kernel)  
[https://github.com/RPISEC/MBE/tree/master/src/lab10](https://github.com/RPISEC/MBE/tree/master/src/lab10)  
[https://github.com/xairy/linux-kernel-exploitation#ctf-tasks](https://github.com/xairy/linux-kernel-exploitation#ctf-tasks)  
[https://github.com/pr0cf5/kernel-exploit-practice](https://github.com/pr0cf5/kernel-exploit-practice)  
[https://ctf-wiki.github.io/ctf-wiki/pwn/linux/kernel/kernel\_uaf/](https://ctf-wiki.github.io/ctf-wiki/pwn/linux/kernel/kernel_uaf/)  

# Browser exploitation

​

## Bascis

​  
[https://slidr.io/bmeurer/javascript-engine-fundamentals-the-good-the-bad-and-the-ugly](https://slidr.io/bmeurer/javascript-engine-fundamentals-the-good-the-bad-and-the-ugly)  
[https://mathiasbynens.be/notes/shapes-ics](https://mathiasbynens.be/notes/shapes-ics)  
[https://www.youtube.com/watch?v=p-iiEDtpy6I](https://www.youtube.com/watch?v=p-iiEDtpy6I)  
[https://liveoverflow.com/tag/browser-exploitation/](https://liveoverflow.com/tag/browser-exploitation/)  
​

## Exploitation basics

​  
[https://faraz.faith/2019-12-13-starctf-oob-v8-indepth/](https://faraz.faith/2019-12-13-starctf-oob-v8-indepth/)  
[http://www.phrack.org/papers/attacking\_javascript\_engines.html](http://www.phrack.org/papers/attacking_javascript_engines.html)  
[https://youtu.be/emt1yf2Fg9g](https://youtu.be/emt1yf2Fg9g)  
[https://media.ccc.de/v/35c3-9657-from\_zero\_to\_zero\_day](https://media.ccc.de/v/35c3-9657-from_zero_to_zero_day)  
​  
​

## Chrome v8

​  
[http://phrack.org/papers/jit\_exploitation.html](http://phrack.org/papers/jit_exploitation.html)  
[https://gts3.org/2019/turbofan-BCE-exploit.html](https://gts3.org/2019/turbofan-BCE-exploit.html)  
​

### Practice v8

​  
[https://github.com/saelo/v9](https://github.com/saelo/v9)  
[https://www.jaybosamiya.com/blog/2019/01/02/krautflare/](https://www.jaybosamiya.com/blog/2019/01/02/krautflare/)  
[https://github.com/osirislab/CSAW-CTF-2018-Finals/tree/master/pwn/ES1337](https://github.com/osirislab/CSAW-CTF-2018-Finals/tree/master/pwn/ES1337)  
[https://github.com/m1ghtym0/write-ups/tree/master/browser/plaid-2018-roll-a-dice](https://github.com/m1ghtym0/write-ups/tree/master/browser/plaid-2018-roll-a-dice)  
[https://github.com/google/google-ctf/tree/master/2018/finals/pwn-just-in-time](https://github.com/google/google-ctf/tree/master/2018/finals/pwn-just-in-time)  
[https://github.com/Changochen/CTF/raw/master/2019/\*ctf/Chrome.tar.gz](https://github.com/Changochen/CTF/raw/master/2019/*ctf/Chrome.tar.gz)  
[https://github.com/m1ghtym0/write-ups/tree/master/browser/realworldctf-quals-2019-accessible](https://github.com/m1ghtym0/write-ups/tree/master/browser/realworldctf-quals-2019-accessible)  
​

### Real World v8 writeups

​  
[https://docs.google.com/document/d/1tHElG04AJR5OR2Ex-m\_Jsmc8S5fAbRB3s4RmTG\_PFnw/edit](https://docs.google.com/document/d/1tHElG04AJR5OR2Ex-m_Jsmc8S5fAbRB3s4RmTG_PFnw/edit)  
[https://blog.exodusintel.com/2019/09/09/patch-gapping-chrome/](https://blog.exodusintel.com/2019/09/09/patch-gapping-chrome/)  
[https://blog.exodusintel.com/2019/03/20/cve-2019-5786-analysis-and-exploitation/](https://blog.exodusintel.com/2019/03/20/cve-2019-5786-analysis-and-exploitation/)  
[https://github.com/vngkv123/aSiagaming/tree/master/Chrome-v8-906043](https://github.com/vngkv123/aSiagaming/tree/master/Chrome-v8-906043)  
[https://labs.bluefrostsecurity.de/blog/2019/04/29/dont-follow-the-masses-bug-hunting-in-javascript-engines/](https://labs.bluefrostsecurity.de/blog/2019/04/29/dont-follow-the-masses-bug-hunting-in-javascript-engines/)  
[https://www.weibo.com/ttarticle/p/show?id=2309404351596157885398](https://www.weibo.com/ttarticle/p/show?id=2309404351596157885398)  
​

## Firefox

​  
[https://vigneshsrao.github.io/play-with-spidermonkey/](https://vigneshsrao.github.io/play-with-spidermonkey/)  
[http://www.phrack.org/issues/69/14.html](http://www.phrack.org/issues/69/14.html)  
​

### Practice

​  
[https://github.com/saelo/feuerfuchs](https://github.com/saelo/feuerfuchs)  
[https://ctftime.org/task/6000](https://ctftime.org/task/6000)  
[https://github.com/bkth/35c3ctf/tree/master/funfox](https://github.com/bkth/35c3ctf/tree/master/funfox)  
​

### RealWorld

​  
[https://doar-e.github.io/blog/2019/06/17/a-journey-into-ionmonkey-root-causing-cve-2019-9810/](https://doar-e.github.io/blog/2019/06/17/a-journey-into-ionmonkey-root-causing-cve-2019-9810/)  
[https://doar-e.github.io/blog/2018/11/19/introduction-to-spidermonkey-exploitation/](https://doar-e.github.io/blog/2018/11/19/introduction-to-spidermonkey-exploitation/)  
[https://blog.bi0s.in/2019/08/18/Pwn/Browser-Exploitation/cve-2019-11707-writeup/](https://blog.bi0s.in/2019/08/18/Pwn/Browser-Exploitation/cve-2019-11707-writeup/)  
[https://phoenhex.re/2017-06-21/firefox-structuredclone-refleak](https://phoenhex.re/2017-06-21/firefox-structuredclone-refleak)  
​

## Safari

​  
[https://blog.ret2.io/2018/06/05/pwn2own-2018-exploit-development/](https://blog.ret2.io/2018/06/05/pwn2own-2018-exploit-development/)  
[https://github.com/m1ghtym0/write-ups/tree/master/browser/CVE-2016-4622](https://github.com/m1ghtym0/write-ups/tree/master/browser/CVE-2016-4622)  
[http://www.phrack.org/papers/attacking\_javascript\_engines.html](http://www.phrack.org/papers/attacking_javascript_engines.html)  
​

### Practice

​  
[http://mightym0.de/ctf/rwctf-2018/allForPlayers.zip](http://mightym0.de/ctf/rwctf-2018/allForPlayers.zip)  
[https://github.com/saelo/35c3ctf/tree/master/WebKid](https://github.com/saelo/35c3ctf/tree/master/WebKid)  
​

### RealWorld

​  
[https://www.inputzero.io/2019/02/fuzzing-webkit.html](https://www.inputzero.io/2019/02/fuzzing-webkit.html)  
[https://doar-e.github.io/blog/2018/07/14/cve-2017-2446-or-jscjsglobalobjectishavingabadtime/](https://doar-e.github.io/blog/2018/07/14/cve-2017-2446-or-jscjsglobalobjectishavingabadtime/)  
[https://saelo.github.io/posts/jsc-typedarray.slice-infoleak.html](https://saelo.github.io/posts/jsc-typedarray.slice-infoleak.html)  
[https://github.com/saelo/pwn2own2018/tree/master/stage0](https://github.com/saelo/pwn2own2018/tree/master/stage0)  
[https://github.com/LinusHenze/WebKit-RegEx-Exploit](https://github.com/LinusHenze/WebKit-RegEx-Exploit)  
[https://github.com/W00dL3cs/exploit\_playground/tree/master/JavaScriptCore](https://github.com/W00dL3cs/exploit_playground/tree/master/JavaScriptCore)  
​

## Edge

​  
[https://github.com/bkth/Tale-Of-Chakra-Bugs](https://github.com/bkth/Tale-Of-Chakra-Bugs)  
[https://www.youtube.com/watch?v=r4J7Zu1RV40](https://www.youtube.com/watch?v=r4J7Zu1RV40) 

### Practice

​  
[https://bruce30262.github.io/Chakrazy-exploiting-type-confusion-bug-in-ChakraCore/](https://bruce30262.github.io/Chakrazy-exploiting-type-confusion-bug-in-ChakraCore/)  
[https://github.com/Nu1LCTF/n1ctf-2018/tree/master/challenges/pwn/Chakra](https://github.com/Nu1LCTF/n1ctf-2018/tree/master/challenges/pwn/Chakra)  
[https://github.com/m1ghtym0/write-ups/tree/master/browser/realworldctf-quals-2019-appetizer](https://github.com/m1ghtym0/write-ups/tree/master/browser/realworldctf-quals-2019-appetizer)  
[https://theromanxpl0it.github.io/articles/2019/09/09/Trend-Micro-CTF-ChakraCore-JIT-exploitation.html](https://theromanxpl0it.github.io/articles/2019/09/09/Trend-Micro-CTF-ChakraCore-JIT-exploitation.html)  
​

### Realworld

​  
[https://phoenhex.re/2019-05-15/non-jit-bug-jit-exploit](https://phoenhex.re/2019-05-15/non-jit-bug-jit-exploit)